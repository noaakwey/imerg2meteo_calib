# Методика калибровки осадков IMERG V07 и ERA5-Land для расчёта R-фактора уравнения RUSLE

## 1. Введение и цель исследования

Точность расчёта дождевого эрозионного потенциала ($R$-фактор по RUSLE) критически зависит от качества исходных данных об осадках. Использование спутниковых продуктов (IMERG V07, NASA) и реанализа (ERA5-Land, ECMWF) без предварительной калибровки ведёт к систематическому занижению интенсивности экстремальных ливней, что недопустимо при оценке рисков почвенной эрозии.

Настоящая методика описывает процедуру калибровки дневных и 3-часовых осадков двух продуктов по данным сети из **202 наземных метеостанций** Европейской России и Татарстана. Итоговые откалиброванные данные охватывают:
- **IMERG V07**: 2001–2025 гг.
- **ERA5-Land**: 1966–2025 гг. (ретроспективный расчёт R-фактора)

Валидация проводилась методом независимой кросс-проверки на **2016–2021 гг.**

---

## 2. Исходные данные

### 2.1. Спутниковые осадки IMERG V07

Использован датасет `NASA/GPM_L3/IMERG_V07`. Исходное разрешение — 30 мин, единицы — мм/ч. В Google Earth Engine реализована агрегация в 3-часовые суммы, соответствующие синоптическим срокам наблюдений (00, 03, 06, 09, 12, 15, 18, 21 UTC):

```javascript
var p3h = imerg
  .filterDate(a, b)
  .map(function(im) { return ee.Image(im).multiply(0.5); }) // мм/ч → мм за 30 мин
  .sum()
  .rename('P_mm_3h');
```

Данные выгружались пофайлово: `IMERG_V07_P3H_mm_YYYY_permanent_trailing.csv`.

### 2.2. Реанализ ERA5-Land

Использован продукт `ECMWF/ERA5_LAND/HOURLY` (переменная `total_precipitation`), агрегированный аналогичным образом в 3-часовые суммы. Исторический ряд охватывает 1950–н.в.; для настоящей работы извлечён период 1966–2025 гг. (`ERA5Land_P3H_mm_YYYY.csv`).

**Особенность ERA5-Land**: реанализ характеризуется хроническим эффектом «ложной мороси» (*drizzle bias*) — безосадочные по данным станций периоды систематически заполняются ERA5 субмиллиметровыми значениями (0.1–0.4 мм). Без специальной обработки это приводит к переоценке объёма осадков более чем на 140%.

### 2.3. Данные наземных метеостанций

В качестве эталона использованы архивные синоптические наблюдения за осадками 202 гидрометеорологических станций. Осадки регистрируются в 3-часовые или 12-часовые сроки. В модель обучения включались только 3-часовые наблюдения (сроки 03, 06, 15, 18 UTC) во избежание внесения ошибки пространственного осреднения при интерполяции 12-часовых данных на более короткие интервалы.

---

## 3. Синхронизация данных

Сопоставление выполнялось **строго по точечному принципу**: каждая запись IMERG/ERA5 на конкретный 3-часовой срок сопоставлялась с соответствующим показанием ближайшей станции по коду WMO. Пространственная интерполяция не применялась. Пропуски на стороне станции трактовались как нулевые осадки, что позволяло корректно разделять влажные и сухие периоды.

---

## 4. Методика калибровки IMERG V07 (Wet-Day Quantile Mapping)

### 4.1. Принцип метода

Для устранения систематического смещения применяется метод квантильного картирования (Quantile Mapping, QM). Трансферная функция $T$ сопоставляет квантили эмпирического распределения IMERG с квантилями распределения наземных станций:

$$T: F_{\text{IMERG}}(x) \mapsto F_{\text{station}}^{-1}(F_{\text{IMERG}}(x))$$

Чтобы избежать искажения частоты дней с осадками, используется подход **Wet-Day QM**: калибруются только ненулевые значения ($P > 0$ мм). Значения ниже нуля не образуются конструктивно.

### 4.2. Настройка модели

- **Тренировочный период**: 2001–2015 гг.
- **Тестовый (валидационный) период**: 2016–2021 гг.
- **Сезонное разбиение**: DJF, MAM, JJA, SON.
- **Число квантилей**: 1000 (шаг 0.1%) по всему CDF, включая нулевые значения.
- **Volume Scaling**: мультипликативная коррекция объёма `mean(station)/mean(IMERG_corr)` по тренировочному периоду; ограничена диапазоном [0.5, 2.0].
- **Экстраполяция хвоста**: линейная по наклону последних 5 квантилей (выше 99.9-го перцентиля).

### 4.3. Результаты валидации IMERG

Кросс-валидация на 202 станциях за 2016–2021 гг. (медианные значения):

| Метрика | Сырые данные | После QM |
|---------|-------------|----------|
| KGE (месячный) | 0.03 | **0.68** |
| KGE (суточный) | −0.04 | **0.49** |
| PBIAS | −68.8% | **−1.4%** |

Медианный объёмный дефицит (PBIAS) сокращается с −68.8% до −1.4%, что соответствует практически полному устранению систематического смещения.

---

## 5. Методика калибровки ERA5-Land (Moving Window Full-Distribution QM)

### 5.1. Специфика задачи и проблема нестационарности

ERA5-Land необходима для ретроспективного расчёта R-фактора за период 1966–2025, недоступный IMERG. Специфика длинного ряда обусловила принципиальные методологические ограничения для стандартных подходов (Таблица 1).

**Таблица 1.** Сравнение протестированных методов калибровки ERA5-Land.

| Метод | Тренировочный период | KGE (мес.), медиана | PBIAS, медиана | Ограничение |
|-------|---------------------|--------------------|----|-------------|
| Wet-Day QM (99 квант.) | 1966–2015 | 0.53 | −31.6% | Нестационарность ряда |
| Parametric Gamma CDF-Matching | 1966–2015 | 0.39 | −16.1% | Сглаживание тяжёлых хвостов |
| Full-Distribution QM (1000 квант.) | 1966–2015 | 0.53 | −30.8% | Нестационарность ряда |
| Full-Distribution QM (1000 квант.) | 2001–2015 | 0.73 | −2.1% | Ограниченный ретроспективный охват |
| **Moving Window QM (±15 лет)** | **адаптивный** | **0.72** | **−6.9%** | — |

**Параметрическое Gamma CDF-Matching** (подгонка теоретического гамма-распределения) показало наихудший KGE = 0.39: 50-летний ряд (~18 000 дождливых суток) статистически достаточен, чтобы двухпараметрическое распределение сгладило тяжёлые хвосты — именно те редкие экстремальные ливни, которые определяют R-фактор.

**Нестационарность климатического ряда** является корневой причиной систематического занижения (PBIAS ≈ −31%) при обучении на полном 50-летнем периоде 1966–2015. Диагностика по 10 станциям показала: трансферная функция, обученная на периоде с доминированием эпохи 1966–2000, не переносится на 2016–2021 вследствие климатических сдвигов режима осадков. При ограничении периода обучения до 2001–2015 медиана PBIAS снижалась до ±5% на каждой из 10 тестовых станций.

### 5.2. Алгоритм Moving Window QM

Для совместного решения проблем нестационарности и ретроспективного охвата реализован алгоритм **Moving Window Full-Distribution QM**.

**Принцип:** для каждого целевого года $Y$ обучающее окно формируется как:

$$[W_{\text{start}}, W_{\text{end}}] = [\max(Y_{\min},\, Y - H),\; \min(Y_{\max},\, Y + H)]$$

где $H = 15$ лет — полуширина окна. Объём обучающей выборки составляет таким образом ~30 лет (≈ одна климатическая нормаль ВМО), что обеспечивает статистическую устойчивость и одновременно климатическую однородность.

**Особенности реализации:**

1. **Full-Distribution QM (1000 квантилей)** строится по всему CDF, включая нули ERA5, без предварительного обнуления дней с «ложной моросью». Это исключает потерю объёма, возникающую при агрессивном частотном адаптировании (FA-QM).

2. **Volume Scaling** — пост-QM мультипликативная коррекция:

$$f_{\text{vol}} = \frac{\overline{P}_{\text{station}}}{\overline{P}_{\text{ERA5,corr}}}\bigg|_{W}$$

Множитель вычисляется по данным окна $W$ и ограничивается диапазоном [0.5, 2.0].

3. При **кросс-валидации** данные периода 2016–2021 явно исключаются из любого обучающего окна, обеспечивая честную независимую оценку.

4. Экстраполяция правого хвоста — линейная (аналогично IMERG).

### 5.3. Результаты валидации ERA5-Land

Кросс-валидация на 202 станциях за 2016–2021 гг. (медианные значения):

| Метрика | Сырые данные | После Moving Window QM |
|---------|-------------|----------------------|
| KGE (месячный) | 0.03 | **0.72** |
| KGE (суточный) | −0.03 | **0.58** |
| PBIAS | −66.1% | **−6.9%** |

ERA5-Land после Moving Window QM превосходит IMERG по KGE (+0.18 по месячным суммам) и близок к нему по PBIAS (−6.9% против −2.0%).

---

## 6. Сравнительная оценка продуктов

| Источник | Период | KGE (мес.) | KGE (сут.) | PBIAS | Назначение |
|----------|--------|-----------|-----------|-------|----------|
| IMERG — сырой | 2001– | 0.03 | −0.04 | −68.8% | — |
| **IMERG — калиброванный** | **2001–2025** | **0.68** | **0.49** | **−1.4%** | Текущий мониторинг |
| ERA5 — сырой | 1966– | 0.03 | −0.03 | −66.1% | — |
| **ERA5 — Moving Window QM** | **1966–2025** | **0.72** | **0.58** | **−6.9%** | Ретроспектива R-фактора |

---

## 7. Темпоральная дезагрегация на часовые растры

Расчёт $R$-фактора и $I_{30}$ требует почасового разрешения. Откалиброванные 3-часовые суммы переносятся на 1-часовые растры GeoTIFF методом **взвешенной дезагрегации**:

1. Три 1-часовых растра внутри каждого 3-часового окна суммируются: $P_{3h} = \sum_{i=1}^{3} P_{1h,i}$.
2. Вычисляются временны́е веса: $W_i = P_{1h,i} / P_{3h}$ при $P_{3h} > 0$.
3. Откалиброванная 3-часовая сумма $P_{3h}^{\text{calib}}$ (от ближайшей станции по индексу Вороного) обратно распределяется по часам:

$$P_{1h,i}^{\text{calib}} = P_{3h}^{\text{calib}} \times W_i$$

Метод сохраняет форму и тайминг исходного ливня (30-мин спутниковые наблюдения), корректируя лишь абсолютный объём.

---

## 8. Статистика метрик KGE и PBIAS по базе 202 станций

Метрика **KGE** (Kling-Gupta Efficiency) определяется как:

$$\text{KGE} = 1 - \sqrt{(r-1)^2 + (\alpha-1)^2 + (\beta-1)^2}$$

где $r$ — коэффициент корреляции Пирсона, $\alpha = \sigma_{\text{sim}}/\sigma_{\text{obs}}$ — отношение стандартных отклонений, $\beta = \mu_{\text{sim}}/\mu_{\text{obs}}$ — отношение средних. Значение KGE $= 1$ соответствует идеальному совпадению; KGE $< 0$ означает, что средний наблюдаемый показатель является лучшим предиктором, чем модель.

**PBIAS** (Percent Bias):

$$\text{PBIAS} = \frac{\sum(Q_{\text{sim}} - Q_{\text{obs}})}{\sum Q_{\text{obs}}} \times 100\%$$

Отрицательные значения указывают на систематическое занижение модели, положительные — на завышение.
