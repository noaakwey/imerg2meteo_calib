[0] Техническое задание
[1] Калибровка и временной даунскейлинг спутниковых осадков IMERG V07
[2] по данным метеостанций ЕЧР методом Wet-Day Quantile Mapping
[3] для расчёта R-фактора RUSLE
[5] КФУ, Институт экологических наук
[6] Версия 2.0 · Февраль 2026
[8] 1. Введение и цель работы
[9] Настоящее техническое задание описывает методологию, входные данные, алгоритм калибровки, результаты верификации и порядок применения откалиброванных данных для расчёта пространственно распределённого R-фактора RUSLE по территории ЕЧР.
[10] Конечная цель — создание временны́х рядов откалиброванных часовых растровых полей осадков с 2001 по 2025 г. для расчёта эрозионного индекса осадков (R-фактора) и его межгодовой динамики. Данные предназначены для долгосрочного углеродного мониторинга (грант 2027–2029).
[13] 2. Описание входных данных
[14] 2.1. Срочные наблюдения метеостанций ЕЧР (эталонные данные)
[15] Источник: база данных метеорологических срочных наблюдений Росгидромет / ВНИИГМИ-МЦД (КМ-1, форма ТМ-1). Набор данных: 202 файла CSV (разделитель «;»), каждый файл — одна станция. Общий объём: 3 242 347 строк за период 1965–2025 гг.
[16] Пространственное покрытие: ЕЧР и прилегающие территории, 41,5–80,6°E, 14,3–66,8°N, высота −25...+2927 м.
[19] Периоды накопления по срокам (КМ-1 Росгидромет)
[21] 2.2. IMERG V07 — 3-часовые суммы по метеостанциям
[22] Источник: NASA GPM IMERG V07 Half-Hourly (ee: "NASA/GPM_L3/IMERG_V07"), продукт permanent, 2001–2021. Данные агрегированы в GEE в виде trailing-sum по синоптическим срокам UTC (00, 03, 06, 09, 12, 15, 18, 21).
[23] Алгоритм агрегирования: два смежных 30-минутных слота (mm/hr × 0,5 = мм за слот) суммируются в 3-часовую сумму за период, предшествующий сроку:
[24] // Отрывок GEE-скрипта:
[25] var p3h = imerg.filterDate(a, b)
[26]   .map(function(im) { return ee.Image(im).multiply(0.5); })
[27]   .sum().rename("P_mm_3h");
[29] Структура хранения: 27 годовых CSV-файлов (IMERG_V07_P3H_mm_YYYY_permanent_trailing.csv), 1999–2025.
[33] 2.3. Часовые растровые стеки IMERG (для R-фактора)
[34] Для расчёта R-фактора дополнительно используются квартальные GeoTIFF-стеки часовых осадков (P1h_mm), сформированные аналогичным способом (0,5 × сумма двух 30-минутных слотов). Каждый файл содержит ~2160–2208 бэндов. Именование: IMERG_V07_P1h_mm_YYYY_QN_permanent.tif.
[35] 3. Методология: Wet-Day Quantile Mapping
[36] 3.1. Принцип метода
[37] Метод Wet-Day Quantile Mapping (QM) трансформирует функцию распределения (CDF) значений IMERG к виду CDF данных метеостанций. В отличие от стандартного мультипликативного bias-correction, QM корректирует всё распределение включая хвосты — т.е. именно те экстремальные события, которые определяют значение R-фактора.
[38] Ключевое отличие Wet-Day QM: калибруются только слоты с P > 0 мм. Это исключает искажение частоты дождливых дней и не допускает превращения нулей в ненулевые значения.
[40] 3.2. Алгоритм сопоставления данных (Direct Point-to-Point Matching)
[41] Загрузить CSV метеостанции и соответствующий IMERG-файл (соответствие по wmo_index / StationName).
[42] Совместить по временной метке datetime_utc — строгое точное совпадение до часа.
[43] В обучающую выборку включать только сроки 03, 06, 15, 18 UTC (3-часовые суммы). Сроки 00 и 12 UTC (12-часовые суммы) исключаются — их включение сгладило бы пиковые интенсивности, что недопустимо для R-фактора.
[44] Обработка пропусков: если IMERG фиксирует осадки, а метеостанция не передала отчёт для данного 3-часового срока, считать P_station = 0 мм. Это позволяет разграничить сухие периоды.
[45] Строки с NaN в P3H_mm (IMERG) исключать из сопоставления.
[47] 3.3. Построение QM-моделей
[48] Для каждой из 202 станций и каждого из 4 сезонов (DJF, MAM, JJA, SON):
[49] Обучающая выборка: 2001–2015 гг. Валидационная: 2016–2021 гг.
[50] Отобрать все слоты с P_imerg > 0 (wet-day выборка) из обучающего периода.
[51] Построить эмпирические CDF (ECDF) для IMERG и станции по 99 перцентилям с шагом 1%.
[52] Обработка хвоста выше 99-го перцентиля — линейная экстраполяция по наклону последних 5 перцентилей (95–99). Это восстанавливает исторические максимумы без создания потолка, особенно важно для конвективных ливней.
[53] Сохранить QM-таблицу (look-up table) в виде массива пар [Q_imerg, Q_station] × 99 значений.
[55] 3.4. Пространственная интерполяция QM-коэффициентов
[56] После получения QM-функций по всем 202 станциям, для каждого квантиля и каждого сезона выполняется пространственная интерполяция на сетку IMERG (0,1° × 0,1°):
[57] Метод: Ordinary Kriging (рекомендуемая модель вариограммы: сферическая или экспоненциальная).
[58] При выраженном высотном градиенте — Kriging with External Drift (ковариата: высота H, м).
[59] Итог: 4 сезона × 99 квантилей = 396 сеточных GeoTIFF с корректирующими коэффициентами.
[61] 4. Применение QM к часовым растрам (Temporal Downscaling)
[62] R-фактор требует часового разрешения. QM обучена на 3-часовых данных; для переноса коррекции на часовые растры применяется алгоритм temporal downscaling с сохранением оригинального распределения осадков внутри каждого 3-часового окна.
[63] 4.1. Алгоритм
[64] Для каждого 3-часового окна (например: 00:00, 01:00, 02:00 → срок 03 UTC) суммировать сырые часовые значения: P_raw_3h = Σ P_raw_1h.
[65] Вычислить долю каждого часа в окне (профиль ливня): W_h = P_raw_1h / P_raw_3h. При P_raw_3h = 0 — все часы окна также нулевые, пропустить.
[66] Применить пространственно интерполированную QM-функцию к P_raw_3h: P_calib_3h = QM(P_raw_3h).
[67] Распределить откалиброванную 3-часовую сумму обратно по часам, сохраняя форму ливня: P_calib_1h = P_calib_3h × W_h.
[68] Записать в выходной COG GeoTIFF (float32, EPSG:4326, 0,1°), суффикс _qm.
[71] 5. Расчёт R-фактора RUSLE
[72] 5.1. Формула (Brown & Foster, 1987)
[74] 5.2. Критерии выделения эрозионных событий
[75] Минимальный порог: P_event ≥ 12,7 мм ИЛИ i > 25 мм/ч за любой час.
[76] Межсобытийный интервал: ≥ 6 ч без осадков (i < 1,27 мм/ч).
[77] I₃₀ = максимальная часовая интенсивность события [мм/ч] (прямое использование в формуле без пересчёта).
[78] Исключить события при среднесуточной T < +1°C (снег): данные ERA5-Land.
[80] 6. Результаты верификации
[81] Оценка выполнена на независимой валидационной выборке 2016–2021 гг. по всем 202 метеостанциям. Метрики рассчитаны на агрегированных месячных и суточных суммах.
[82] 6.1. Сводные показатели качества
[86] 6.2. Физическая верификация: рекордный июль 2008 г. (Казань)
[87] Событие 21 июля 2008 г. (ливень за 23 минуты, суточный максимум 58 мм, месячная сумма 198 мм при норме 68 мм) использовалось как контрольный тест на восстановление экстремумов.
[89] Сырой IMERG «пропустил» само событие (0,0 мм в критическом интервале) и завысил фоновые слабые осадки. QM-коррекция через линейную экстраполяцию хвоста (> 99-го перцентиля) восстанавливает объём события до уровня, соответствующего исторически достоверному распределению.
[91] 6.3. Интерпретация высокого стандартного отклонения после QM
[92] Стандартное отклонение PBIAS выросло с 54,9% до 110,8%. Это не деградация: при медиане −2,0% большое ст. откл. означает, что у части станций после коррекции появляется небольшое переоценивание, тогда как другие станции корректируются лучше. Широкий разброс отражает физическую неоднородность оценки IMERG в зависимости от типа осадков, рельефа и удалённости от береговой линии. Для итоговой карты R-фактора разброс дополнительно сглаживается пространственным кригингом QM-коэффициентов.
[94] 7. Программная реализация
[95] 7.1. Стек технологий
[97] 7.2. Структура проекта
[98] imerg_calibration/
[99]   data/
[100]     stations/             # 202 CSV срочных наблюдений
[101]     imerg_stations/       # 27 CSV IMERG P3H по станциям
[102]     imerg_rasters/        # Квартальные GeoTIFF стеки IMERG P1h
[103]   models/
[104]     qm_tables/            # QM look-up tables (npz/pickle, станция × сезон)
[105]     qm_grids/             # Интерп. QM на сетку (396 GeoTIFF, 4 сезона × 99 квантилей)
[106]   output/
[107]     imerg_corrected/      # Скорректированные P1h стеки (COG, суффикс _qm)
[108]     r_factor_annual/      # Годовые R-карты [МДж·мм/га·ч·год], 2001-2025
[109]     r_factor_mean/        # Среднемноголетняя карта (2001-2021, permanent IMERG)
[110]     validation/           # Метрики KGE/PBIAS, графики, scatter plots
[111]   scripts/
[112]     01_parse_stations.py  # Привести метеоданные к 3ч, отфильтровать сроки
[113]     02_merge_imerg_obs.py # Попарное сопоставление по wmo_index + datetime_utc
[114]     03_qm_fit.py          # Wet-Day QM: ECDF, линейная экстраполяция хвоста
[115]     04_qm_kriging.py      # Kriging QM-коэффициентов на сетку IMERG
[116]     05_downscaling.py     # Temporal downscaling P1h растров (W_h × P_calib_3h)
[117]     06_rfactor.py         # Расчёт EI30, R-фактор по RUSLE
[118]     07_validation.py      # Метрики, визуализация (KGE, PBIAS, scatter)
[120] 8. Известные ограничения
[122] 9. Ожидаемые выходные данные
[123] 202 QM-модели (станция × 4 сезона) — look-up таблицы с линейной экстраполяцией хвоста.
[124] 396 сеточных GeoTIFF QM-коэффициентов (4 сезона × 99 квантилей, EPSG:4326, 0,1°).
[125] Откалиброванные квартальные GeoTIFF стеки P1h_qm (формат идентичен входным).
[126] Годовые карты R-фактора за 2001–2025 гг. (COG GeoTIFF, МДж·мм/га·ч·год).
[127] Среднемноголетняя карта R-фактора 2001–2021 (permanent IMERG).
[128] Отчёт верификации: таблицы KGE/PBIAS, boxplot, scatter plots по 202 станциям, до и после QM.
[130] 10. Ключевые источники
[131] Renard, K.G. et al. (1997). Predicting Soil Erosion by Water: RUSLE. USDA ARS Agricultural Handbook 703.
[132] Brown, L.C. & Foster, G.R. (1987). Storm erosivity using idealized intensity distributions. Transactions ASAE, 30(2), 379–386.
[133] Huffman, G.J. et al. (2023). NASA GPM IMERG Algorithm Theoretical Basis Document, v7.
[134] Themeßl, M.J., Gobiet, A., Heinrich, G. (2012). Empirical-statistical downscaling and error correction of regional climate models. Climatic Change, 112, 449–468.
[135] Piani, C. et al. (2010). Statistical bias correction of global simulated daily precipitation and temperature. Journal of Hydrology, 395, 199–215.
[138] КФУ, Институт экологических наук · Казань, 2026 · v2.0
